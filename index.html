<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<title>Messe Tool – Komplett</title>
<script src="KundenData.js" defer></script>
<script src="ArtikelData.js" defer></script>
  <script defer>
    console.log(ArtikelData);
  </script>
<style>
    body { font-family: sans-serif; background: #f3f3f3; padding: 2rem; }
    .container { max-width: 800px; margin: auto; background: white; padding: 2rem; border-radius: 8px; }
    input, select, textarea { width: 100%; margin-bottom: 1rem; padding: 0.5rem; }
    ul { list-style: none; padding: 0; }
    button { padding: 0.5rem 1rem; margin: 0.25rem; }
    .red { background-color: #cc0000; color: white; }
    .green { background-color: #009900; color: white; }
  </style>
</head>
<body>
<div id="kundenwarnung"></div><div class="container" style="text-align: right; margin-top: 20px;">
<h1>Messe-Bestelltool</h1>
<div style="display:flex; gap:0.5rem; align-items:center;">
<input id="kundeSuche" placeholder="Bestandskunde suchen..." style="flex:1; height: 2.5rem; padding: 0 1rem; font-size: 1rem; box-sizing: border-box;" type="text"/>
<button onclick="document.getElementById('neukundeFormular').style.display = 'block'" style="height: 2.5rem; padding: 0 1rem; font-size: 1rem; box-sizing: border-box;">+ Neukunde anlegen</button>
</div>
<ul id="suchErgebnisse"></ul>
<div id="neukundeFormular" style="display:none; border:1px solid #ccc; padding:1rem; margin-top:1rem;">
<h3>Neukunde anlegen</h3>
<input id="firma" placeholder="* Firmenname"/>
<input id="vorname" placeholder="* Vorname"/>
<input id="nachname" placeholder="* Nachname"/>
<input id="strasse" placeholder="* Straße"/>
<input id="plz" placeholder="* PLZ"/>
<input id="ort" placeholder="* Ort"/>
<select id="land">
<option selected="" value="Deutschland">Deutschland</option>
<option>Österreich</option><option>Frankreich</option><option>Italien</option><option>Niederlande</option>
</select>
<input id="ustid" placeholder="USt-ID (nur EU-Ausland)" style="display:none;"/>
<input id="telefon" placeholder="* Telefon"/>
<input id="email" placeholder="* E-Mail"/>
<button onclick="neukundeSpeichern()">Neukunde speichern</button>
</div><div id="gespeicherteListe" style="margin-top: 10px;"></div><div id="speicherButtons" style="margin-top: 10px;">
</div>
<p id="aktuellerKunde"></p>
<p id="sperrhinweis" style="color:red; font-weight:bold;"></p>
<input id="scanInput" placeholder="Artikelnummer eingeben/scannen"/>
<ul id="warenkorbListe"></ul>
<p id="gesamtpreis">Gesamt: 0,00 €</p>
<label for="lieferdatum">Gewünschter Liefertermin:</label>
<input id="lieferdatum" type="date"/>
<label for="kommentar">Kommentare oder Wünsche:</label>
<textarea id="kommentar"></textarea>
<button onclick="abschliessen()" style="background-color: #007bff; color: white; padding: 6px 10px; border: none; margin-right: 8px;">💾 Bestellung speichern</button>
<button onclick="zeigeGespeicherteBestellungen()" style="background-color: #6c757d; color: white; padding: 6px 10px; border: none;">📂 Gespeicherte laden</button>
<button onclick="exportiereBestellungen()">📤 Als Weclapp-CSV exportieren</button>
</div>

<script>
const artikelliste = [
  { artikelnummer: "6012", name: "Dip Dye Neon * Lollipop Trees", preis: 7, vielfaches: 6 },
  { artikelnummer: "6005", name: "Dip Dye Neon * Pink Infusion", preis: 7, vielfaches: 6 }
];

const kundenliste = [
  { Name: "Schöne Sörgelei GbR (München)", Kundennummer: "K001", Gesperrt: "Nein" },
  { Name: "Papeterie Welle (Berlin)", Kundennummer: "K002", Gesperrt: "Ja" }
];

let warenkorb = [];
let bestellung = { kunde: null };

function sucheKunde(eingabe) {
  const feld = document.getElementById("kundensuche");
  const result = kundenliste.find(k => k.Name.toLowerCase().includes(eingabe.toLowerCase()));
  const warn = document.getElementById("kundenwarnung");
  if (result) {
    bestellung.kunde = result;
    warn.textContent = result.Gesperrt === "Ja" ? "⚠️ Kunde ist gesperrt!" : "";
  }
}

function sucheArtikel(eingabe) {
  const result = artikelliste.find(a => a.artikelnummer.includes(eingabe));
  if (result) {
    const vorhanden = warenkorb.find(p => p.artikelnummer === result.artikelnummer);
    if (vorhanden) {
      vorhanden.menge += result.vielfaches;
    } else {
      warenkorb.push({ ...result, menge: result.vielfaches });
    }
    renderWarenkorb();
  }
}

function renderWarenkorb() {
  const w = document.getElementById("warenkorb");
  w.innerHTML = "";
  warenkorb.forEach((item, i) => {
    const zeile = document.createElement("div");
    const gesamt = (item.preis * item.menge).toFixed(2);
    zeile.innerHTML = `
      <button onclick="aendereMenge(${i}, -${item.vielfaches})" class="minus">–</button>
      ${item.artikelnummer} – ${item.name}, Menge: ${item.menge}, Preis: ${item.preis.toFixed(2)} €, Gesamt: ${gesamt} €
      <button onclick="aendereMenge(${i}, ${item.vielfaches})" class="plus">+</button>
    `;
    w.appendChild(zeile);
  });
}

function aendereMenge(i, diff) {
  warenkorb[i].menge += diff;
  if (warenkorb[i].menge <= 0) warenkorb.splice(i, 1);
  renderWarenkorb();
}

function exportiereCSV() {
  let csv = "Kundennummer;Kundenname;Artikelnummer;Menge;Einzelpreis;Gesamtpreis\n";
  warenkorb.forEach(p => {
    const g = p.menge * p.preis;
    csv += `${bestellung.kunde?.Kundennummer || ""};${bestellung.kunde?.Name || ""};${p.artikelnummer};${p.menge};${p.preis};${g.toFixed(2)}\n`;
  });
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "weclapp_bestellungen.csv";
  a.click();
  URL.revokeObjectURL(url);
}
</script></body>
</html>
